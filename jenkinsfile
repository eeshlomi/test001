pipeline {
	agent any
	stages {
		stage('test') {
			options { retry(2) }
			steps {
				sleep(time:1,unit:"SECONDS")
				echo "Commit hash is ${GIT_COMMIT}"
				sh '''#!/bin/bash
					cat ../../tmp/test
					[ "${GIT_BRANCH}" = "master" ] && exit 1  # should be the oppsite
					exit 0
				'''
			}
		}
		stage('merge-to-master') {
			when { not { branch 'master' } }
			steps {
				echo "This is a branch"
			}
		}
	}
}
