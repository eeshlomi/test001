pipeline {
	agent any
	environment { STATE = 'try' }
	stages {
		stage('test') {
			options { retry(2) }
			when { not { equals expected: 'skip', actual: env.STATE } }
			steps {
				echo 'STATE is ${STATE}'
				sh 'STATE=skip'
				error ('this is just a test')
			}
		}
	}
}
